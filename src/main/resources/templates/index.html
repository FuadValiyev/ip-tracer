<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>IP Tracer - Fuad Edition</title>
    <meta charset="UTF-8">
    <meta name="description" content="Trace IP and domain geolocation info">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
</head>
<body class="bg-light d-flex flex-column min-vh-100">

<div class="container mt-5 mb-4">
    <div class="text-center mb-4">
        <h2>IP Tracer</h2>
        <p>Enter an IP address or domain name to trace</p>
    </div>

    <!-- IP Trace Form -->
    <form action="/trace" method="post" class="mb-4">
        <div class="input-group">
            <input type="text" name="ip" class="form-control" placeholder="e.g. 8.8.8.8 or google.com" required>
            <button type="submit" class="btn btn-primary">Trace</button>
        </div>
    </form>

    <!-- Batch Upload -->
    <form action="/batch" method="post" enctype="multipart/form-data" class="mb-4">
        <label class="form-label">Upload IP list (TXT):</label>
        <div class="input-group">
            <input type="file" name="file" class="form-control" accept=".txt" required>
            <button class="btn btn-outline-dark" type="submit">Batch Trace</button>
        </div>
    </form>

    <!-- Error message -->
    <div th:if="${error}" class="alert alert-danger" role="alert">
        <span th:text="${error}"></span>
    </div>

    <!-- IP Result Card -->
    <div th:if="${info}" class="card mb-4">
        <div class="card-header bg-success text-white">
            IP Information
        </div>
        <div class="card-body">
            <ul class="list-group list-group-flush">
                <li class="list-group-item"><strong>IP:</strong> <span th:text="${info.query}"/></li>
                <li class="list-group-item"><strong>Country:</strong> <span th:text="${info.country}"/></li>
                <li class="list-group-item"><strong>Region:</strong> <span th:text="${info.regionName}"/></li>
                <li class="list-group-item"><strong>City:</strong> <span th:text="${info.city}"/></li>
                <li class="list-group-item"><strong>ZIP Code:</strong> <span th:text="${info.zip}"/></li>
                <li class="list-group-item"><strong>Coordinates:</strong> <span th:text="${info.lat}"/> , <span th:text="${info.lon}"/></li>
                <li class="list-group-item"><strong>Timezone:</strong> <span th:text="${info.timezone}"/></li>
                <li class="list-group-item"><strong>ISP:</strong> <span th:text="${info.isp}"/></li>
                <li class="list-group-item"><strong>Organization:</strong> <span th:text="${info.org}"/></li>
                <li class="list-group-item"><strong>AS:</strong> <span th:text="${info.as}"/></li>
                <li class="list-group-item"><strong>Status:</strong> <span th:text="${info.status}"/></li>
                <li class="list-group-item">
                    <strong>Risk Flags:</strong>
                    <span th:if="${info.proxy}">üõë Proxy </span>
                    <span th:if="${info.hosting}">üè¢ Hosting </span>
                    <span th:if="${info.mobile}">üì± Mobile Network </span>
                    <span th:if="${!info.proxy and !info.hosting and !info.mobile}">‚úÖ None</span>
                </li>
            </ul>
        </div>
    </div>

    <!-- Export Buttons -->
    <div th:if="${info}" class="mt-3 d-flex flex-wrap gap-2">
        <a href="/export" class="btn btn-outline-primary btn-sm" target="_blank">‚¨á Download Result (JSON)</a>
        <a href="/export-history" class="btn btn-outline-secondary btn-sm" target="_blank">‚¨á Download History (JSON)</a>
        <a href="/export-history-csv" class="btn btn-outline-success btn-sm" target="_blank">‚¨á Download History (CSV)</a>
    </div>

    <!-- Map Marker -->
    <div th:if="${info}" class="mb-5 mt-4">
        <h5>Location on Map:</h5>
        <div id="map" style="height: 300px;"></div>
    </div>

    <!-- Search History -->
    <div th:if="${history}" class="mb-5">
        <div class="d-flex justify-content-between align-items-center">
            <h4>Previous Searches</h4>
            <a href="/clear" class="btn btn-outline-danger btn-sm">Clear History</a>
        </div>

        <table class="table table-striped mt-2">
            <thead>
            <tr>
                <th>IP</th>
                <th>Country</th>
                <th>Region</th>
                <th>City</th>
                <th>ISP</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="h : ${history}">
                <td th:text="${h.query}"></td>
                <td th:text="${h.country}"></td>
                <td th:text="${h.regionName}"></td>
                <td th:text="${h.city}"></td>
                <td th:text="${h.isp}"></td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Batch Results -->
    <div th:if="${batchResults}" class="mb-5">
        <h4>Batch Results</h4>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th>IP</th><th>Country</th><th>Region</th><th>City</th><th>ISP</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="ip : ${batchResults}">
                <td th:text="${ip.query}"></td>
                <td th:text="${ip.country}"></td>
                <td th:text="${ip.regionName}"></td>
                <td th:text="${ip.city}"></td>
                <td th:text="${ip.isp}"></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Footer -->
<footer class="bg-dark text-white text-center py-4 mt-auto small">
    IP Tracer &copy; 2025 | Crafted by Fuad |
    <a href="https://github.com/FuadValiyev/ip-tracer" target="_blank" class="text-white text-decoration-underline">View on GitHub</a>
</footer>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script th:if="${info}">
    const lat = [[${info.lat}]];
    const lon = [[${info.lon}]];

    const map = L.map('map').setView([lat, lon], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
    }).addTo(map);
    L.marker([lat, lon]).addTo(map)
        .bindPopup("Location: " + lat + ", " + lon)
        .openPopup();
</script>

</body>
</html>
